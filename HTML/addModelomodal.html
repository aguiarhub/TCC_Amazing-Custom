<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modal</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/style_addModelomodal.css" >

</head>
<body>
    <form class="box" action="post" enctype="multipart/form-data">
    <div>
        <div>
            <label for="modNome">Nome:</label>
            <input type="text" placeholder="Nome">
        </div>
        <div>
            <label for="valor">Valor:</label>
            <input type="number" name="valor" placeholder="R$ 00,00">
        </div>

        <div class="upload-area" onclick="procurarArqClick()" ondrop="uploadArq(event)" ondragover="return false">
            <h5 id="upload-txt">Arraste e solte o arquivo aqui</h5>
            <input type="file" id="input" hidden>
        </div>

        <div>
            <button>Cadastrar</button>
        </div>
    </div>
    </form>
</body>
<script>
    var areaUpload = document.querySelector(".upload-area")
    var areaTxt = document.querySelector("#upload-txt")
    var input = document.querySelector("#input")
        
    var fileobj, file
        
    areaUpload.addEventListener("dragover", (event) =>{
        event.preventDefault()
        areaTxt.textContent = "Solte o arquivo aqui"
    })
    
    areaUpload.addEventListener("dragleave", (event) =>{
        event.preventDefault()
        areaTxt.textContent = "Arraste e solte o arquivo aqui"
    })
    
    areaUpload.addEventListener("drop", (event) =>{
        event.preventDefault()
        file = event.dataTransfer.files[0]
        showImg()
    })

    input.addEventListener("change", function(){
        file = this.files[0]
        showImg()
    })
    

    function procurarArqClick(){
        input.click()
        procurarArq()
    }

    function showImg(){
        let tipoArq = file.type
        let tiposAceitados = ["image/jpeg","image/jpg","image/png"]
    
        if(tiposAceitados.includes(tipoArq)){
            let leitorArq = new FileReader()
            leitorArq.onload = ()=>{
                let urlArq = leitorArq.result
                let img = `<img src="${urlArq}" alt="">`
                console.log(img)
                areaUpload.innerHTML = img
            }
            leitorArq.readAsDataURL(file);
        }else{
            alert("Extensão invalida! Selecione um arquivo válido(.jpeg/.jpg/.png)")
            areaTxt.textContent = "Arraste e solte o arquivo aqui"
        }
    }
    
    function uploadArq(e){
        e.preventDefault()
        fileobj = e.dataTransfer.files[0]
        updateJsArq(fileobj)
    }   
    
    function procurarArq(){
        document.getElementById('input').onchange = function() {
        fileobj = document.getElementById('input').files[0];
        updateJsArq(fileobj);
    }
    }

    function updateJsArq(obj){
        if(obj != undefined) {
            var form_data = new FormData();                  
            form_data.append('file', obj);
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "../Admin/functions/uploadFile.php", true);
            xhttp.onload = function(event) {
            
                if (xhttp.status == 200) {
                    console.log("Uploaded!");
                } else {
                    alert(xhttp.status);
                }
            }
            xhttp.send(form_data);
        }
    }
</script>
</html>